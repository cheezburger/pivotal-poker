@model PivotalTrackerAPI.Domain.Model.PivotalStory

<h2 id="title">@Model.Name</h2>
<span id="description">@Model.Description</span>

<h3>Your Estimate</h3>

<div style="clear: right;">
    @for(int i=0; i<=3; i++){
        <div data-score="@i" class="Selection Card FloatLeft">@i</div>
    }
    <div style="clear: both;"></div>
</div>

<div>
    <h3>All Estimates</h3>
    <div id="otherEstimates">
    </div>
</div>
<p id="done" class="hidden">
    @Html.ActionLink("Start next story", "Index", "Projects")
</p>
<p>
    @Html.ActionLink("Reset game", "Reset", "Story")
</p>
<script id="card" type="text/html">
    {{#votes}}
    <div class='OtherEstimate FloatLeft'>
        <div class='Card' style='display:inline'>{{vote}}</div>
        <p>{{name}}</p>
    </div>
    {{/votes}}
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $('.Selection').click(function () {
            $(".Card").removeClass("Selected");
            $(this).addClass("Selected");
            $.post('@Url.Action("vote")', { score: $(this).data('score') });
        });
        $('#otherEstimates').smartupdater({
            url: '@Url.Action("status")',
            dataType: 'json',
            minTimeout: 1000
        }, function (data) {
            $('#otherEstimates').empty().append(ich.card(data));
            if (data.completed) $('#done').show();
        });
    });
</script>